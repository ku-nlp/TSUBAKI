###################################
# 検索エンジン基盤 TSUBAKI README #
###################################

2012/04/30 Daisuke Kawahara <dk@i.kyoto-u.ac.jp>


TSUBAKIは、科研特定領域研究「情報爆発」(2006年度〜2010年度)において、京
都大学黒橋・河原研究室にて開発した検索エンジン基盤です。その特徴は、構
文・格解析、同義語・句のマッチングなど深い言語解析技術に基づく検索です。
1CPUあたり100万文書程度の検索が可能で、複数CPUの並列化により大規模文書
集合の検索に対応しています。日本語文書と英語文書の検索が可能です。

TSUBAKIで検索を行うには、検索対象文書に対して次の2ステップの処理を行う
必要があります。

  1. 検索対象文書に言語解析を適用し、その解析結果をXML形式で出力
     (以後、このXML形式を「TSUBAKI標準フォーマット」と呼びます。)
  2. 標準フォーマットデータからインデックスを生成

以下では、準備、TSUBAKI標準フォーマット変換(上記1)、インデックス生成(上
記2)、検索の順番に説明します。


====
準備
====

* 必要なライブラリ、モジュールのインストール

- 必要なライブラリのインストール
  -- libxml (http://xmlsoft.org/)
  -- TinyCDB (http://www.corpit.ru/mjt/tinycdb.html)


- 必要なPerlモジュールのインストール (CPANからダウンロード、インストール)
  -- Unicode::Japanese
  -- PerlIO::gzip
  -- XML::LibXML
  -- CDB_File
  -- Text::Darts
  -- Error (Module::Metadata, version, Perl::OSType, Module::Buildも必要)


* 言語解析ツール・データベースのインストール

- 日本語の文書を検索する場合に必要なツール・データベースのインストール

  -- 日本語形態素解析システムJUMAN,のダウンロード、インストール
     http://nlp.ist.i.kyoto-u.ac.jp/index.php?JUMAN

  -- 日本語構文・格解析システムKNPのダウンロード、インストール
     http://nlp.ist.i.kyoto-u.ac.jp/index.php?KNP

  -- SynGraph日本語データベース(同義語・句の辞書)のダウンロード
     http://... を取得し、TSUBAKI直下(このディレクトリ)にて展開してください。


- 英語の文書を検索する場合に必要なツールのインストール

  -- HPSG構文解析器Enjuのダウンロード、インストール
     http://www.nactem.ac.uk/enju/index.ja.html

  ※ SynGraph英語データベースは未リリースです。英語の同義語・句のデータ
     を別途用意すれば、SynGraphデータベース形式に変換して使うことができ
     ます。詳細は、SynGraphのドキュメントをご覧ください。


* 設定

検索対象文書データのある場所を指定し、TSUBAKIの設定ファイルを自動生成し
ます。以下では、このREADMEがあるディレクトリを $TSUBAKI_DIR と表します。

- $TSUBAKI_DIRにおいて、以下のように、./setup.sh を実行

  例1) 日本語サンプル文書データを対象にする場合
       ./setup.sh -d sf2index/sample_data_ja

  例2) 英語サンプル文書データを対象にする場合
       ./setup.sh -e -d sf2index/sample_data_en

  ※ ./setup.shの重要なオプションの説明
       -d 検索対象文書データパス : 検索対象文書データの場所を指定
       -e                        : 英語の文書を検索する場合
       -c 出力設定ファイル名	 : 出力する設定ファイル名を指定 (default: $TSUBAKI_DIR/conf/configure)

これによって、解析ツールなどのインストール場所も自動設定され、設定ファ
イル $TSUBAKI_DIR/conf/configure が生成されます。


* 検索サーバプログラムのコンパイル

- $TSUBAKI_DIRにおいて、make を実行

  ※ コンパイルが失敗する場合は、$TSUBAKI_DIR/search/Makefileにおいて、
     CXXFLAGSとCDB_LIBをcdb.h、libcdb.aのインストール場所に応じて修正してください。


===========================
TSUBAKI標準フォーマット変換
===========================

検索対象文書データに言語解析を適用し、TSUBAKI標準フォーマットに変換しま
す。現在のところ、検索対象文書データの形式として、HTML文書のみに対応し
ています。

以下では、$TSUBAKI_DIR/sf2index/sample_data_ja にある、日本語のサンプル
文書データを対象にして説明します。日本語サンプル文書データ以外を用いる
場合に設定が必要な箇所にはその旨を記述しています。

- $TSUBAKI_DIRにおいて、make DATADIR=$TSUBAKI_DIR/sf2index/sample_data_ja html2sf を実行

  ※ 日本語サンプル文書データ以外を対象にする場合は、上記の設定で指定し
     た文書データパスをDATADIRとして設定してください。


================
インデックス生成
================

TSUBAKI標準フォーマットからインデックスを生成します。

- $TSUBAKI_DIRにおいて、make DATADIR=$TSUBAKI_DIR/sf2index/sample_data_ja indexing を実行

  ※ 日本語サンプル文書データ以外を対象にする場合は、上記の設定で指定し
     た文書データパスをDATADIRとして設定してください。


====
検索
====

* 検索テスト

- $TSUBAKI_DIR/sf2indexにおいて、"./search.sh -c $TSUBAKI_DIR/conf/configure クエリ"
  を実行して検索 (日本語のクエリはUTF8で入力)

   例) ./search.sh -c $TSUBAKI_DIR/conf/configure 旅館	→ hitcountが2になる
       ./search.sh -c $TSUBAKI_DIR/conf/configure 駅	→ hitcountが1になる


* ブラウザからの検索

- 検索サーバとスニペットサーバの起動
  $TSUBAKI_DIR/scripts/server-all.sh -c $TSUBAKI_DIR/conf/configure start

  -- 止める場合は次のとおり
     $TSUBAKI_DIR/scripts/server-all.sh -c $TSUBAKI_DIR/conf/configure stop

- $TSUBAKI_DIR/cgi/index.cgiをブラウザでたたいて検索


============
ドキュメント
============

より詳細なドキュメントは、TSUBAKI Wikiを参照してください。

TSUBAKI Wiki: http://tsubaki-wiki.ixnlp.nii.ac.jp/index.php
              username: tsubaki-user
              password: tsu8k!

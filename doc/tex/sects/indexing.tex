\section{インデキシング}

\subsection{概要}

本節では，TSUBAKIが検索時に利用するインデックスについて述べる．TSUBAKI
では転置インデックス方式を採用している．TSUBAKIが検索時に利用するインデッ
クスの種類および各インデックスに含まれる情報を表\ref{size}に示す．
%（サイズについては後述する．）
%
フレーズ検索や，近接検索を実現するため，索引表現の出現位置および単語の
出現した文ID（標準フォーマットから抽出可能）をインデックスデータに登録
している．また，索引表現の出現位置は，通常検索，同義表現検索のどちらに
おいても文書スコアの計算時に利用される．
%
TSUBAKIでは表\ref{size}に示した情報をバイナリ化し，独自のフォーマットで管理している．
(図\ref{sample_index})

\begin{figure}[t]
\begin{center}
\includegraphics[height=\columnwidth,clip,angle=-90]{figs/index.eps}
\end{center}
\caption{インデックスのフォーマット}
\label{sample_index}
\end{figure}

\begin{table}[t]
\begin{center}
\caption{TSUBAKIで用いるインデックスデータ}
\label{size}
\footnotesize
\begin{tabular}{l|c|c|c|c|c||p{0.09\columnwidth}||r}
\hline
インデックスの種別&索引表現自身&文書頻度&出現文書情報&出現文情報&出現位置情報&文書頻度による足切り&サイズ [TB]\\\hline
単語&○&○&○&○&○&×&1.17\\
係り受け&○&○&○&×&×&×&0.89\\
同義表現&○&○&○&×&○&×&1.84\\
同義表現の係り受け&○&○&○&×&○&○&4.81\\\hline
\end{tabular}
\end{center}
\end{table}

% 表\ref{size}に各インデックスデータに含まれる情報，足切りの有無，全体のファイルサイズを示す．表より同義表
% 現の係り受けインデックスのファイルサイズが大きいことがわかる．
% また，係り受けインデックスに比べ，単語インデックスの方がファイルサイズが
% 大きくなっているが，これは，単語インデックスが全単語の全出現
% 位置をインデックスとして登録しているのに対し，係り受け関係インデックスの
% 方は，自立語同士の係り受け関係に限定，さらに位置情報を保持していないためである．

各インデックスの索引表現は，標準フォーマットに含まれているSYNGRAPHの解
析結果から抽出される．そのため，インデキシングの際，あらためて文書を
言語解析しない．

以下に，インデックス作成の手順を示す．配布ツールを用いた，より具体的な作
成手順については，本マニュアル末尾の付録を参照されたい．

★ステップを図示する
\begin{description}
\item [Step 1:] ウェブ標準フォーマット化されたデータから索引表現を抽出する
\item [Step 2:] 索引表現のマージし，インデックスを作成する
\item [Step 3:] インデックスをバイナリ化する
\item [Step 4:] 文書頻度，タイトル，URLなどのデータベースを構築する
\end{description}

以下，各インデックスについて述べる．

% \subsection{インデックスの単位}
% 
% TSUBAKIでは，インデックスの単位として以下のものを採用している．
% 
% \begin{itemize}
% \item 単語（自立語，機能語全て）
% \item 自立語同士の係り受け関係
% \item 同義表現（単語，句）
% \item 同義表現同士の係り受け関係
% \end{itemize}
% 
% \noindent
% 単語および自立語同士の係り受け関係についてはKNPの解析結果から,同
% 義表現,同義表現同士の係り受け関係についてはSynGraph~\cite{syngraph}の解析結果か
% ら取得している．
% 
% 以下では各インデックスについて述べる．
% 



\subsection{タームの抽出}

\subsubsection{単語ターム}

SYNGRAPHの解析結果から代表表記化された単語とその読みを索引表現と
して抽出する．図\ref{knp_result}に示した「子ども服をせんたくする」とい
う文をKNPで解析した結果からは以下の索引表現が抽出される．

\begin{figure}[t]
\begin{center}\includegraphics[height=0.3\columnwidth,clip,angle=-90]{figs/dpnd.eps}
\end{center}
\caption{「子ども服をせんたくする」をKNPで解析して得られる係り受け関係（代表表記化済み，下線が引かれている単語は内容語）}
\label{dpnd}
\end{figure}

\begin{flushleft}
子供／こども，服／ふく，を／を，洗濯／せんたく，選択／せんたく，する／する
\end{flushleft}

\noindent
このようにJumanの代表表記を索引表現とすることで，「子供」，「子ども」，「こども」のような表記の揺れは
解消され，表記揺れに起因する検索漏れを軽減する効果が期待できる．

また，「せんたく」のように複数の代表表記（「洗濯」，「選択」）が考えられ
る単語については，その全ての表記が文書中に出現したものと見なす．この時，各単語の出現頻度は，
代表表記の個数で割ったものになる（つまり，「せんたく」が1回だけ現れる文書では，「洗濯」および「選択」が
0.5回ずつ出現していると見なされる．）

%% 単語インデックスは，索引語の他に以下の情報を持っている．

%% \begin{itemize}
%% \item 単語自身
%% \item 単語の文書頻度
%% \item 単語が出現した文書ID
%% \item 各文書中での単語の出現頻度
%% \item 単語の出現した文ID
%% \item 単語の出現した位置
%% \end{itemize}



\subsubsection{係り受け関係ターム}

SYNGRAPHの解析結果から係り受け関係を抽出し，索引表現として用いる．
%
図~\ref{knp_result}に挙げたKNPの解析結果から得られる係り受け関係を図
\ref{dpnd}に示す．これより，「子ども服をせんたくする」からは，

\begin{flushleft}
子供／こども→服／ふく，服／ふく→洗濯／せんたく，服／ふく→選択／せんたく
\end{flushleft}

\noindent
が索引表現として抽出される．文節間だけでなく，内容語間の係り受け関係（子供/こども→服/ふく）も
索引表現として抽出されることに注意されたい．
%
単語インデックスの場合と同様に，係り先または係り元に複数の代表表記があ
る場合は，その全ての組み合わせを索引表現として抽出し，その出現頻度は，
組み合わせの数で割ったものとしている．

%% 係り受けインデックスに含まれる情報は以下の通りである．

%% \begin{itemize}
%% \item 係り受け自身
%% \item 係り受けの文書頻度
%% \item 係り受けが出現した文書ID
%% \item 各文書中での係り受けの出現頻度
%% \end{itemize}

%% \noindent
%% 単語インデックスとは異なり，出現文に関する情報および出現位置に関する情報
%% は含まれないことに注意されたい．


% \subsection{インデックスとして登録される情報}
% 
% TSUBAKIでは以下の情報をインデックスデータ作成時に各ページから抽出している．
% 
% \begin{itemize}
% \item 索引表現(単語,同義表現,自立語同士の係り受け関係,同義表現間の係り受け関係)
% \item 索引表現が出現した文書ID
% \item 索引表現の出現した文ID（単語,自立語同士の係り受け関係のみ）
% \item 索引表現の出現した位置（単語,自立語同士の係り受け関係のみ）
% \end{itemize}
% 
% 以下では抽出される各データについて述べる．
% 
% \subsubsection{索引表現が出現した文書ID}
% 
% TSUBAKIでは，各ファイル名が8桁の数字で表現される文書IDとなっているため，
% 索引表現を抽出したファイル名を索引表現が出現した文書IDとして利用している．

\subsubsection{同義表現ターム}

★TSUBAKIでは，代表表記による表記揺れを吸収した検索に加え，単語または句
の同義表現についてもインデックスを作成することで，より柔軟な検索を実現し
ている．例えば，クエリとして「乳児の虫歯を予防する」が与えられた場合，
「乳児」が「赤ちゃん」と同義であること，「予防」が「防ぐ」と同義であるこ
とを同時に考慮した検索が行われる．その結果として，「赤ちゃんの虫歯を防ぐ
には」といったクエリとは異なる表現が含まれる文書であっても検索結果として
得ることが可能となる．

SYNGRAPHの解析結果から得られるSynノードを索引表現として抽出する．
例えば，図\ref{syn_result}からは，

\begin{flushleft}
\texttt{<}SYNID:乳児/にゅうじ\texttt{>}, \texttt{<}SYNID:s121:乳飲み子/ちのみご\texttt{>}, 
\texttt{<}SYNID:虫歯/むしば\texttt{>}, \texttt{<}SYNID:s15141:虫歯/むしば\texttt{>}, \texttt{<}SYNID:s15137:歯/は\texttt{>},
\texttt{<}SYNID:予防/よぼう\texttt{>}, \texttt{<}SYNID:s17557:予防/よぼう\texttt{>}, \texttt{<}SYNID:s4234:防ぐ/ふせぐ\texttt{>},
\texttt{<}SYNID:s35:回避/かいひ\texttt{>}
\end{flushleft}

\noindent
が索引表現として抽出される．
%
このとき，Synノードに付与されている以下の文法素性は削除される．

\begin{itemize}
\setlength{\itemsep}{-2pt}
\item \texttt{<可能>}
\item \texttt{<尊敬>}
\item \texttt{<受身>}
\item \texttt{<使役>}
\item \texttt{<反義語>}
\item \texttt{<上位語>}
\end{itemize}

また文書中での出現頻度には，SYNGRAPH解析結果より与えられている「スコア」を利用する．
例えば，「小学生」という表現に対して「\texttt{子供>}」というSynノードが上位語として
付与されるが，この時，この文書には，Synノード「\texttt{<子供>}」が0.7回出現しているものと見なす．

%% また，各同義表現インデックスの出現頻度は，SynGraphにより与えられるスコア
%% を利用している．例えば，基本ノード\texttt{<}SYNID:乳児/にゅうじ\texttt{>}
%% については1が，Synノード\texttt{<}SYNID:乳児/にゅうじ\texttt{>}について
%% は0.99が，同じくSynノード\texttt{<}SYNID:予防/よぼう\texttt{>}については
%% 0.693がそれぞれ各インデックスの出現頻度として登録される．

%% 同義表現インデックスは以下の情報を含んでいる．

%% \begin{itemize}
%% \item 同義表現自身
%% \item 同義表現の文書頻度
%% \item 同義表現が出現した文書ID
%% \item 各文書中での同義表現の出現頻度
%% \item 同義表現の出現した位置
%% \end{itemize}

%% \noindent
%% これらの情報は，単語・係り受けインデックス同様，バイナリ化され保持される．


% \subsection{同義表現同士の係り受けインデックス}

% SYNノード-SYNノード，SYNノード-基本ノード間の係り受け関係を索引表現と
% して抽出する．例えば，図\ref{syn_result}に示したSYNGRAPHの解析結果から
% は以下の係り受け関係が抽出される．

% \begin{flushleft}
% \texttt{<}SYNID:乳児/にゅうじ\texttt{>}→\texttt{<}SYNID:虫歯/むしば\texttt{>},
% \texttt{<}SYNID:乳児/にゅうじ\texttt{>}→\texttt{<}SYNID:s15141:虫歯/むしば\texttt{>},
% $\dots$中略$\dots$
% \texttt{<}SYNID:s15137:歯/は\texttt{>}→\texttt{<}SYNID:s35:回避/かいひ\texttt{>}
% \end{flushleft}

% \noindent
% 出現頻度には，同義表現インデックス同様，SYNGRAPHの解析結果より得られる
% スコアを利用する．具体的には，係り先と係り元にあたるSYNノード，基本ノードが持つスコアの積を出現頻度としている．

% 同義表現係り受けインデックスについては，データサイズを小さくするため，
% 1億ページ中で文書頻度が10未満の索引表現については登録しない．


%% 最後に，同義表現同士の係り受けインデックスに登録されている情報を以下に示す．

%% \begin{itemize}
%% \item 同義表現の係り受け関係自身
%% \item 同義表現の係り受け関係の文書頻度
%% \item 同義表現の係り受け関係が出現した文書ID
%% \item 各文書中での同義表現の係り受け関係の出現頻度
%% \item 同義表現の係り受け関係が出現した位置
%% \end{itemize}

% ある単語が同一の文，または近隣の文に出現している文書の検索を可能にするた
% め，TSUBAKIでは，単語または係り受け関係の出現した文の情報を保持する．具
% 体的には，標準フォーマットによりウェブページ中の各文についてIDが振られて
% いるため，TSUBAKIではこの文IDを利用する．なお，この情報は同義表現および
% 同義表現同士の係り受け関係については抽出しないことに注意されたい．
% 
% ある単語が近接している文書の検索を可能にするため，TSUBAKIでは，単語また
% は係り受け関係の出現した文書中での位置情報を保持する．具体的には，単語単
% 位で数えた場合，その単語が何単語目にあるかという情報を単語の出現位置情報
% として抽出する．係り受け関係については，係り元の単語の出現位置を係り受け
% 関係の出現位置として見なす．なお，この情報は同義表現および同義表現同士の
% 係り受け関係については抽出しないことに注意されたい．


\subsection{タームのマージ}


\subsection{バイナリ化}

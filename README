###################################
# 検索エンジン基盤 TSUBAKI README #
###################################

2012/04/27 Daisuke Kawahara <dk@i.kyoto-u.ac.jp>


============
ドキュメント
============

各種ドキュメントは、TSUBAKI Wikiを参照してください。
  http://tsubaki-wiki.ixnlp.nii.ac.jp/index.php
    username: tsubaki-user
    password: tsu8k!


================
クイックスタート
================

サンプルデータを使って、TSUBAKIで検索できるようにするまでの手順を以下に
示します。

* 目次
1 必要なライブラリなどのインストール
2 インデクシング
3 検索の設定
4 検索のテスト
5 ブラウザからの検索


* 1. 必要なツール、ライブラリなどのインストール

- JUMAN, KNPの取得、インストール
  -- JUMAN (http://nlp.ist.i.kyoto-u.ac.jp/index.php?JUMAN)
  -- KNP (http://nlp.ist.i.kyoto-u.ac.jp/index.php?KNP)

- Utils, SynGraphなどの取得
  これらの取得をこのディレクトリ(TSUBAKI直下)で行い、ここにUtilsとSynGraphを置くと、
  以下の設定が自動的に行われるので楽です

  cvs -d :pserver:nobody@reed.kuee.kyoto-u.ac.jp:/share/service/cvs login (password: kuro-language)
  cvs -d :pserver:nobody@reed.kuee.kyoto-u.ac.jp:/share/service/cvs co Utils
  cvs -d :pserver:nobody@reed.kuee.kyoto-u.ac.jp:/share/service/cvs co SynGraph


  標準フォーマットを作成する場合と英語で検索する場合は、WWW2sfも取得

  cvs -d :pserver:nobody@reed.kuee.kyoto-u.ac.jp:/share/service/cvs co WWW2sf

- 必要なライブラリのインストール
  -- libxml (http://xmlsoft.org/)
  -- TinyCDB (http://www.corpit.ru/mjt/tinycdb.html)

- 必要なperlモジュールのインストール (CPANからダウンロード、インストール)
  -- Unicode::Japanese
  -- PerlIO::gzip
  -- XML::LibXML
  -- CDB_File
  -- Error
     Module::Metadata, version, Perl::OSType, Module::Buildも必要


* 2. インデクシング
(TSUBAKI/sf2index/sample_data以下にあるサンプルの標準フォーマットを用いる場合)

1 cd TSUBAKI/sf2index
2 make


* 3. 検索の設定

1 TSUBAKI/search下でmakeして、検索サーバをコンパイル
  -- Makefile: TinyCDBのcdb.h、libcdb.aの場所などを適切に指定

2 TSUBAKI直下において、./setup.sh を実行 (cgi/configureファイルが生成される)

3 TSUBAKI/cgi/configureファイルを開いて、以下の項目を修正
  -- 日本語の検索をする場合は、以下の項目を修正
  KNP_COMMAND	/usr/local/bin/knp
  JUMAN_COMMAND	/usr/local/bin/juman
  JUMAN_RCFILE	/usr/local/etc/jumanrc
  KNP_RCFILE	/usr/local/etc/knprc

  -- 英語の検索をする場合は、以下の項目を修正
  WWW2SF_PATH     /home/kawahara/share/tool/WWW2sf/tool/perl
  IS_ENGLISH_VERSION	1

  なお、サンプル以外の標準フォーマットを対象にする場合は、以下の項目も変更する。
  DIR_PREFIX_FOR_SFS_W_SYNGRAPH  /home/kawahara/public_html/TSUBAKI/sf2index/sample_data
  SYNGRAPH_DFDB_PATH     /home/kawahara/public_html/TSUBAKI/sf2index/sample_data


* 4. 検索テスト
- サンプルのクエリファイル(TSUBAKI/sf2index/query.sample.ja.sexp)を用いた検索テスト
  -- TSUBAKI/sf2index下で
     ./search.sh -d sample_data -f query.sample.ja.sexp


- 任意のクエリによる検索
  -- TSUBAKI/sf2index下で
     ./search.sh -d sample_data クエリ(UTF8で)


* 5. ブラウザからの検索

- 設定
  -- TSUBAKI/data/PORTS.SYNを修正 (サンプル標準フォーマットを使う場合は設定しなくてよい)
     --- インデックスの場所とポート番号(任意の番号でOK)を記入する
     /home/kawahara/public_html/TSUBAKI/sf2index/sample_data none 39999

     ※ ポート番号(この場合39999)はTSUBAKIスレーブサーバが使う

  -- TSUBAKI/cgi/configureを修正
     --- orchid01のポート39999でTSUBAKIスレーブサーバ、ポート59001でスニペットサーバを上げる場合

     HOSTS_PREFIX   orchid
     HOSTS_START    01
     HOSTS_END      01
     SEARCH_SERVERS_FOR_SYNGRAPH     orchid01 39999
     STANDARD_FORMAT_LOCATION        orchid01 59001   000


- 検索サーバとスニペットサーバの起動
  -- TSUBAKI検索サーバを起動
     --- 任意のノードで次のコマンドを実行
     TSUBAKI/scripts/tsubaki-server.sh start

     --- 止める場合は次のとおり
     TSUBAKI/scripts/tsubaki-server.sh stop

  -- スニペットサーバを起動
     --- 任意のノードで次のコマンドを実行
     TSUBAKI/scripts/snippet-server.sh start

     --- 止める場合は次のとおり
     TSUBAKI/scripts/snippet-server.sh stop

- TSUBAKI/cgi/index.cgiをブラウザでたたいて検索
